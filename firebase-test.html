<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Authentication Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        input {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            margin: 10px 5px 10px 0;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        .hidden {
            display: none;
        }
        
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Firebase Authentication Test</h1>

    <!-- Login Section -->
    <div id="login-section" class="section">
        <h2>Login</h2>
        
        <!-- Email/Password Login -->
        <div>
            <h3>Email/Password Login</h3>
            <input type="email" id="email" placeholder="Email" />
            <input type="password" id="password" placeholder="Password" />
            <button onclick="signInWithEmail()">Sign In</button>
            <button onclick="signUpWithEmail()">Sign Up</button>
        </div>
        
        <!-- Google Login -->
        <div>
            <h3>Google Login</h3>
            <button onclick="signInWithGoogle()">Sign In with Google</button>
        </div>
    </div>

    <!-- User Info Section -->
    <div id="user-section" class="section hidden">
        <h2>User Info</h2>
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>Display Name:</strong> <span id="user-name"></span></p>
        <p><strong>Firebase UID:</strong> <span id="user-uid"></span></p>
        <p><strong>Email Verified:</strong> <span id="user-verified"></span></p>
        
        <button onclick="testLaravelAPI()">Test Laravel API</button>
        <button onclick="signOut()">Sign Out</button>
    </div>

    <!-- API Response Section -->
    <div id="api-section" class="section hidden">
        <h2>Laravel API Response</h2>
        <pre id="api-response"></pre>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signInWithPopup, 
            GoogleAuthProvider,
            signOut as firebaseSignOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDWxZ_wMLKKHa0edWlBKhWoRe_K65cNGq8",
            authDomain: "langlearn-a53cd.firebaseapp.com",
            projectId: "langlearn-a53cd",
            storageBucket: "langlearn-a53cd.firebasestorage.app",
            messagingSenderId: "25224987204",
            appId: "1:25224987204:web:b97b94d6d2a648b6843211",
            measurementId: "G-CN7E85B2B5",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // Make functions global so HTML can access them
        window.signInWithEmail = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('Email sign in successful:', userCredential.user);
            } catch (error) {
                console.error('Email sign in error:', error);
                alert('Sign in failed: ' + error.message);
            }
        };

        window.signUpWithEmail = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log('Email sign up successful:', userCredential.user);
                alert('Account created successfully!');
            } catch (error) {
                console.error('Email sign up error:', error);
                alert('Sign up failed: ' + error.message);
            }
        };

        window.signInWithGoogle = async function() {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                console.log('Google sign in successful:', result.user);
            } catch (error) {
                console.error('Google sign in error:', error);
                alert('Google sign in failed: ' + error.message);
            }
        };

        window.testLaravelAPI = async function() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('No user logged in');
                    return;
                }

                // Get Firebase ID token
                const idToken = await user.getIdToken();
                console.log('Firebase ID Token:', idToken);

                // Send to Laravel API
                const response = await fetch('http://127.0.0.1:8000/api/auth/firebase-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        firebase_token: idToken
                    })
                });

                const data = await response.json();
                console.log('Laravel API Response:', data);

                // Display response
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
                document.getElementById('api-section').classList.remove('hidden');

                if (response.ok) {
                    alert('Laravel API test successful! Check the response below.');
                } else {
                    alert('Laravel API test failed: ' + (data.error || 'Unknown error'));
                }

            } catch (error) {
                console.error('API test error:', error);
                alert('API test failed: ' + error.message);
            }
        };

        window.signOut = async function() {
            try {
                await firebaseSignOut(auth);
                console.log('User signed out');
            } catch (error) {
                console.error('Sign out error:', error);
                alert('Sign out failed: ' + error.message);
            }
        };

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                console.log('User logged in:', user);
                
                // Update UI with user info
                document.getElementById('user-email').textContent = user.email || 'N/A';
                document.getElementById('user-name').textContent = user.displayName || 'N/A';
                document.getElementById('user-uid').textContent = user.uid;
                document.getElementById('user-verified').textContent = user.emailVerified ? 'Yes' : 'No';
                
                // Show user section, hide login section
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('user-section').classList.remove('hidden');
            } else {
                // User is signed out
                console.log('User logged out');
                
                // Show login section, hide user section
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('user-section').classList.add('hidden');
                document.getElementById('api-section').classList.add('hidden');
            }
        });
    </script>
</body>
</html>